---
title: "[Tableau] 태블로 신병훈련소 17기 4일차"
excerpt: "#Tableau #신병훈련소 #데이터_시각화 #히트맵 #테이블계산 #시간데이터분석"

categories:
  - tableau
tags:
  - [tableau, data_visualization]

permalink: /tableau/bootcamp-17-4/

toc: true
toc_sticky: true

date: 2023-02-08
last_modified_at: 2023-02-08
---

##  ✏️ 4일차

> 📖 4일차 학습 안내  
> - **히트맵**을 사용하여 시공간의 패턴을 한 눈에 보기
> - **테이블 계산** 활용 : 빅맥지수를 이용하여 각국의 구매력 차이와 변화에 대한 인사이트 찾아 보기


### 💡 테이블 계산(Table Calculation)

- 테이블 계산식의 전제조건 : **무조건 집계값을 이용해야 함**
- 태블로 계산 유형

    ```
  행 데이터(Raw Data) 👉 집계(Aggregation) 👉 테이블 계산식(Table Calculation)
    ```
  
- 태블로에서는 행 데이터로 화면에 포함된 차원을 따라 집계한 후, 그 집계값을 가지고 분석
- 분석 요건에 따라 집계값을 이용해 다시 한번 값을 재계산해야 하는 경우 **테이블 계산식**을 이용

> 4개년 평균 매출/ 해당 연도 평균 매출과 분기별 매출 차이를 알고 싶다면?    

   ![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_1.png){: .align-center}
    
   - **분석 > 평균 라인**을 위의 그림처럼 추가하면 4개년 평균 매출액과 해당 연도 평균 매출액 확인 가능
   - But, 위의 평균 라인은 시각화에서 그 값을 표현해줄 뿐 이 값 자체를 다시 계산을 하는 데에 사용할 수 없음
   - 이렇게 **집계된 합계 매출액**으로 다시 평균을 계산해야 하는 경우에 **테이블 계산**을 이용!


- 테이블 계산식은 **집계**를 기반으로 **범위와 방향에 따라** `합계, 누계, 순위, 구성 비율, 선/후행 비교 등`과 같은 값들을 다시 도출해낼 수 있음 

<br>

#### 1️⃣ 테이블 계산식 생성

- [계산된 필드 만들기] > 함수 중 '**테이블 계산**'에 해당되는 함수 사용 (**WINDOW_AVG()**)
- 4개년 평균 매출/ 해당 연도 평균 매출 필드 생성

    ```
  [수식]
  WINDOW_AVG( SUM([매출]) )
    ```
  
  - 왜 두 필드의 수식이 같을까?
    - <span style="color:orange">주의)</span> 테이블 계산식을 사용하는 경우, 집계된 값을 다시 한번 구하는 것이기 때문에 **어느 범위까지, 어느 방향으로 구할 것인지**를 정확히 지정해야 함
- 수식이 같기 때문에 값 또한 동일하게 보임!
  - "**해당 연도 평균 매출**" 필드 의 테이블 계산 편집 필요  

  ![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_2.png){: .align-center}

<br>

#### 2️⃣ 테이블 계산식 편집    

- 계산 범위를 보면 '테이블(옆으로)'로 전체 테이블이 기준으로 되어 있음
- '해당 연도 평균 매출'의 경우, **연도에 한정**해서 봐야하기 때문에 계산 범위를 '**패널(옆으로)**'로 변경

![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_3.gif){: .align-center}

- 요구사항인 '4개년 평균 매출/ 해당 연도 평균 매출과 분기별 매출 차이' 구하기
    - 행 선반에 있는 4개년 평균 매출, 해당 연도 평균 매출 필드를 각각 더블 클릭하면 수식으로 편집 가능
    - 왼쪽에 있는 **합계(매출)** 필드를 끌어다가 수식 안으로 넣으면 [합계(매출)] 형태로 수식 내에 위치
    - 두 필드 각각 `SUM(매출) - [ 4개년|해당 연도 평균 매출]` 형태로 값 수정

![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_4.png){: .align-center}

<br>

#### 3️⃣ 퀵테이블 사용

> 전월 대비 매출 차이를 알고싶다면?

- 열 선반의 필드에서 마우스 오른쪽 클릭 > 퀵 테이블 계산 > 차이
- 2017년 1월의 경우, 2016년 12월 매출과의 차이를 나타내는데 이와 같은 결과가 나온 것은 테이블 계산의 범위가 전체 테이블이기 때문

![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_5.png){: .align-center}

- 전체 연도가 아니라 해당 연도까지만 끊어서 보고싶다면?
  - 계산되는 범위를 '**패널(옆으로)**'로 변경

- 계산이 되는 기준 변경 가능 : `이전, 다음, 첫번째, 지난`
  - **이전** : 해당 월(2월)의 이전 월(1월)과 비교
  - **다음** : 해당 월(2월)의 다음 월(3월)과 비교
  - **첫번째** : 해당 연도의 첫번째 월(1월)과 해당 월(2월) 비교
  - **지난** : 해당 연도의 마지막 월(12월)과 해당 월(2월) 비교

<br>

### 💡 라인 차트

시간의 흐름에 따라 데이터의 패턴과 트렌드를 보는데 가장 많이 사용되는 시각화

<br>

### 💡 하이라이트 테이블/히트맵

- [하이라이트 테이블 또는 히트 맵 작성](https://help.tableau.com/current/pro/desktop/ko-kr/buildexamples_highlight.htm)

<br>

### 💡 [웨비나] 시간데이터를 바라보는 여러가지 방법

- 시간 데이터의 경우, 주로 line plot 형태로 시각화
- 증감 추이 확인을 위한 경우 : 중간 과정의 point들을 제외하면 시작값, 끝값만이 남게 되어 전체적인 추이 확인 가능
  - 시작값, 끝값을 선택할 수 있게 매개변수 처리하게 되면 **다이나믹 슬로프 차트(Dinamic Slop Chart)**로 응용 가능
    - `FIRST() == 0 OR LAST() == 0` 수식 적용시 T/F로 데이터 생성
    - 참인 경우만 필터로 걸면 FIRST, LAST 만 데이터로 보이게 됨
- **Cycle Plot**
  - 반복되는 시간 패턴을 파악하기에 좋은 형태의 시각화
  - 시간대 별 추이를 영역 그래프로 표현
- **Highlight Table**
  - 연도별뿐 아닌 월별, 요일별 등 세부적인 패턴 확인을 위해 사용
  - 열 선반, 행 선반에 각각 시간(예를 들어 월 vs 일, 연도 vs 월)을 추가하고 마크 선반의 **색상**에 패턴을 보고자 하는 데이터를 Drag & Drop
  - 히트맵 형식으로 하이라이트 테이블이 생성되면서 색 차이로 데이터 패턴 확인 가능
  - 색상 편집에서 **가운데 값**을 더 크게 주면 값이 특히 큰 값에만 색이 다르게 표현
    - 대신 적은 값을 가진 데이터의 패턴은 확인이 어려움
  - 응용 : 지역별 패턴 확인
    - 세부정보에 지역 추가, 열 선반과 행 선반에 각각 경도, 위도 추가
    - 하이라이트 테이블의 각 셀(?)이 Map 형태로 시각화
- **Bump Chart**
  - 원래 수치의 변동보다는 순위 변동 확인에 효과적인 시각화
- **Hockey Stick Chart**
  - 특정 지표가 시간에 따라서 어떻게 성장하는가를 비교하는 데에 효과적인 시각화
- **같은 데이터라도 다양한 방법으로 시각화할 수 있으며, 다양한 각도에서 바라볼 때 예전에 보지 못했던 인사이트를 얻을 수 있음**


<br>

##  ✏️ 4일차 과제

> 도시대기 미세먼지 데이터와 빅맥 지수 데이터를 이용하여 다양한 시각화를 이용해 “시간 분석” 해보기

### 1️⃣ 라인 차트

```
월 별 미세먼지 평균 지수 확인
```


<details>
<summary>최종결과 🌈</summary>
<div markdown="1">       

![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_6.png){: .align-center}  

- 2010년부터 2019년까지 **연속된 형태**로 연월별 미세먼지 트렌드 확인


</div>
</details>

<br>

1. 열 선반에 월(기준연월), 행 선반에 PM10 추가
   - PM10 집계 **평균**으로 변경
   - 해당 월은 불연속적 형태로 월별 평균값을 나타내게 됨
   
   ![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_7.png){: .align-center}
    - 봄, 겨울에 미세먼지가 심한 것 확인

2. 열 선반의 월을 **연속된 형태**(예. 2020년 1월)로 변경
      - 2010년부터 2019년까지 월 별로 미세먼지가 어떻게 변화했는지 추이 확인(최종 결과 참고)

3. **날짜의 옵션을 위쪽(불연속형)을 선택하느냐 아래쪽 (연속형)을 선택하느냐에 따라서 시간 표현을 다르게 할 수 있음**

<br>

### 2️⃣ 하이라이트 테이블

```
- 시도 별로 월 별 미세먼지 변화량 살펴보기
- 텍스트에 색상을 추가로 표현시 여러 값의 패턴을 더 명확하게 볼 수 있음
```

<details>
<summary>최종결과 🌈</summary>
<div markdown="1">       

![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_8.png){: .align-center}  

</div>
</details>

<br>

1. 열 선반에 월(기준년월), 행 선반에 시도 추가
   - 월은 **불연속 형태**
2. 마크 모양 **사각형** 선택
3. 마크 색상, 텍스트를 **평균 PM10**수치로 표현(Drag & Drop)
   - 미세먼지가 높을 수록 붉은색으로 미세먼지가 낮을수록 파란색으로 표현


<br>

### 3️⃣ 테이블 계산식을 이용한 시간 분석

- 빅맥 지수 : 각 나라의 물가, 구매력 평가를 비교하기 위해 고안된 경제지표
- 나라 별 빅맥 가격을 달러로 환산하고 이를 비교하면 나라 별 물가를 비교할 수 있음
- big-mac-raw-index 데이터에 있는 **Dollar Price**는 **달러로 환산된 빅맥 가격**
- **Dollar Price를 이용해서 2000년도 대비 2020년도의 빅맥 가격이 국가별로 얼마나 상승**했는지 비교

```
가격 상승 비율을 통해서 어느 나라 빅맥 가격이 가장 큰 폭으로 상승했는지 살펴보기
```

> **예)**  
> A국가 : 빅맥 500원 -> 1000원 👉 100% 증가  
> B국가 : 빅맥 1600원 -> 2000원 👉 25% 증가  
> 👉 A국가의 빅맥 가격이 작지만, A국가가 더 많이 가격 상승


<details>
<summary>최종결과 🌈</summary>
<div markdown="1">       

![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_9.png){: .align-center}  

> **Q. 어느 나라 빅맥 가격 변동 비율이 가장 큰가요?**  
> - Brazil
> - Taiwan은 5.3% 증가한 데에 비해 Brazil의 경우 191.5% 증가

</div>
</details>

<br>

1. 열 선반에 Date 필드 추가 후 **2000년, 2020년만 유지**
2. Dollar Price > 퀵 테이블 계산 > **비율 차이**
   - 그래프가 원하는 대로 나오지 않음!
3. 퀵 테이블 계산 편집
   - 계산 **기준**을 '**첫번째**'로 변경
4. 국가별로 확인하기 위해 마크 **세부정보, 텍스트**에 Name Drag & Drop
5. 비율 차이에 따른 색 변화 함께 확인하기 위해 색상에 행 선반에 있는 평균 Dollar Price (비율 차이) Drag & Drop

<br>

### 4️⃣ 덤벨 차트

```
연도 별로 최소 빅맥 가격과 최대 빅맥 가격의 차이 변화 한 눈에 살펴보기  
+ Korea_Price 이용해서 한국의 빅맥 가격 변동도 함께 살펴보기!
```

<details>
<summary>최종결과 🌈</summary>
<div markdown="1">       

![image](/assets/images/posts_img/tableau_bootcamp/day4/20230208_tableau_bootcamp_17_4_10.png){: .align-center}  


</div>
</details>

<br>

1. 행 선반에 불연속형 "**년월(Date)**" 배치
   - 불연속형 부분의 **자세히** > 사용자 지정 > **연도/월** 선택
2. 열 선반에 **측정값**필드 배치 및 **측정값 이름**필드를 필터 배치
   - Dollar Price, Korea Price만 체크
3. 측정값 선반에 있는 Dollar Price의 **집계 형식**을 **최소값**으로 변경 👉 빅맥 최소 금액
   - Dollar Price를 측정값 선반에 한 번 더 추가하여 집계 형식을 **최대값**으로 변경 👉 빅맥 최대 금액
   - 측정값 선반에 최종적으로 위치하는 필드: `최대(Dollar Price`, `합계(Korea_Price)`, `최소(Dollar Price)`
4. 마크 형태를 **원**으로 변경하고, **마크의 색상**을 **측정값 이름**으로 구분(Drag & Drop)
5. 오른쪽의 알약을 **이중축**으로 설정
6. 만약 라인 그래프가 원보다 위에 있는 경우, 2개의 측정값의 위치를 서로 바꿔줌





<br><br>